(function(factory){function $namespace(name){for(var arr=name.split(","),r=0,len=arr.length;r<len;r++){for(var i=0,k,name=arr[r].split("."),parent={};k=name[i];i++){i===0?eval("(typeof "+k+')==="undefined"?('+k+'={}):"";parent='+k):parent=parent[k]=parent[k]||{}}}return parent}var smartbox=$namespace("jd.smartbox");(!smartbox||smartbox._id!=="jd.smartbox")&&(window.jd.smartbox=factory())})(function(){function e(t,r,o){if(!t||!r||!o){return}if(t instanceof Array){for(var a=0,s=t.length;a<s;a++){e(t[a],r,o)}return}if(r instanceof Array){for(var a=0,s=r.length;a<s;a++){e(t,r[a],o)}return}window.__allHandlers=window.__allHandlers||{};window.__Hcounter=window.__Hcounter||1;function i(e,t,r,o){e.__hids=e.__hids||[];var a="h"+window.__Hcounter++;e.__hids.push(a);window.__allHandlers[a]={type:t,handler:r,wrapper:o}}function n(e,t){return function(){return e.apply(t,arguments)}}if(window.addEventListener){var p=n(o,t);i(t,r,o,p);t.addEventListener(r,p,false)}else if(window.attachEvent){var p=n(o,t);i(t,r,o,p);t.attachEvent("on"+r,p)}else{t["on"+r]=o}}function t(){var e=arguments[0]||{},t=1,r=arguments.length,o;if(typeof e!="object"&&typeof e!="function")e={};for(;t<r;t++)if((o=arguments[t])!=null)for(var a in o){var s=o[a];if(e===s)continue;if(s!==undefined)e[a]=s}return e}function r(){var e=document.documentElement,t=document.body,r=e&&e.scrollLeft||t&&t.scrollLeft||window.pageXOffset||0,o=e&&e.scrollTop||t&&t.scrollTop||window.pageYOffset||0;return[r,o]}function o(e,t){p(e,t,"add")}function a(e,t){p(e,t,"remove")}function s(e,t){if(!e||!t)return null;var r=(typeof e=="object"?e.className:e).split(" ");for(var o=0,a=r.length;o<a;o++){if(t==r[o]){return t}}return null}function i(e){return typeof e=="string"?document.getElementById(e):e}function n(e,t){if(!e){return}var r;if(!window["_loadCss"]||window["_loadCss"].indexOf(e)<0){r=document.createElement("link");r.setAttribute("type","text/css");r.setAttribute("rel","stylesheet");r.setAttribute("href",e);r.setAttribute("id","loadCss"+Math.random());document.getElementsByTagName("head")[0].appendChild(r);window["_loadCss"]?window["_loadCss"]+="|"+e:window["_loadCss"]="|"+e}r&&typeof t=="function"&&(r.onload=t);return true}function p(e,t,r){if(!e){return}var o=function(e,t,r){if(!e){return}var o=e.className,a=o?o.split(" "):[];if(r=="add"){if(!s(o,t)){a.push(t);e.className=a.join(" ")}}else if(r=="remove"){var i=[];for(var n=0,p=a.length;n<p;n++){if(t!=a[n]&&" "!=a[n]){i.push(a[n])}}e.className=i.join(" ")}};if(typeof e=="string"){var a=e.split(",");for(var n=0,p=a.length;n<p;n++){if(a[n]){o(i(a[n]),t,r)}}}else if(e instanceof Array){for(var n=0,p=e.length;n<p;n++){if(e[n]){o(e[n],t,r)}}}else{o(e,t,r)}}function l(e,t){var r=t||"\\s";var o=new RegExp("(^"+r+"*)|("+r+"*$)","g");return e.replace(o,"")}function d(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/ /g,"&nbsp;")}var c=false;var h=window.JD&&JD.device&&JD.device.scene=="weixin";var u=window.JD&&JD.device&&JD.device.scene=="wxwork";var f=window.JD&&JD.device&&JD.device.scene=="qq";var w=window.JD&&JD.cookie?JD.cookie.get("sq_index_simple"):"";var m=0;var g=function(e){return{_id:"jd.smartbox",_status:0,_fwload:0,factoryId:e||"",oldKey:"",hotwords:null,projectId:null,isFucus:false,curTab:1,onShow:false,dtimer:null,flagEn:false,sCssloaded:false,version:"",ddHistory:false,ddHiscache:null,showpps:"",outter:null,defalutFixed:false,cgi:"//dd-search.jd.com/?key={#key#}&callback=ddSearchCb"+(e||"")+"&terminal={#version#}&ver=2&zip=1&newjson=1",cgiMonitor:{smartboxTimer:null,timeout:5e3},drakInfo:{isDark:true,onact:false,key:"",text:"",desc:"",link:""},hotPageInfo:{page:1,pagesize:15,totPage:1,qqruleid:"3",wxruleid:"4"},remKeyInfo:{isRem:false,okey:"",rkey:""},opt:{deley:300,empMode:1,scene:1,stype:1,showShop:true,shopKwFix:"（店铺）",gloabalKwFix:"（海囤全球）",songli:"",css:"//wq.360buyimg.com/fd/h5/wxsq_dev/search/css/search_smartbox.min_{#timestr#}.css",kwObj:"keyWord",searchBtn:"searchBtn",clearBtn:"searchClearBtn",cancelBtn:"cancelBtn",smartboxBlock:"smartboxBlock",searchUrl:"//wqs.jd.com/search/index.shtml?key={#key#}&sf={#sf#}&as={#as#}",shopSearchUrl:"//wqs.jd.com/search/shop_index.shtml?key={#key#}&sf={#sf#}&as={#as#}",placeholder:"搜索商品/店铺",noDark:false,rdprex:"7095",showCb:null,hideCb:null,keyInput:null,searchRd:"",hotRd:"",hotUrl:"//wq.jd.com/mcoss/keyword/keywordsearch?ruleid={#ruleid#}&pi={#page#}&pc={#pagesize#}&tpl={#tpl#}&callback=hotwordCb",wxAdid:"2",qqAdid:"4",darkRd:"",darkPre:"",qqruleid:"3",wxruleid:"4",tpl:"1",pagesize:15,scrollToHideKeyboard:true,noOutter:false,version:"weixin",terminal:""}}};var y=g(null);var k=[y];y.init=function(e){if(this._status===1){console.warn("smartbox duplicate initialization, please check your code again.")}if(window.closeSearchEntrance){return}this.initParam(e);this.initTpl();this.bindEvent();this.initDark();this.reportJdClick();this._status=1};y.initParam=function(e){e&&t(this.opt,e);this.opt.kwObj=this.smartQuery("#"+this.opt.kwObj);this.opt.searchBtn=this.smartQuery("#"+this.opt.searchBtn);this.opt.clearBtn=this.smartQuery("#"+this.opt.clearBtn);this.opt.cancelBtn&&(this.opt.cancelBtn=this.smartQuery("#"+this.opt.cancelBtn));this.opt.smartboxBlock=typeof this.opt.smartboxBlock==="string"?this.smartQuery("#"+this.opt.smartboxBlock):this.opt.smartboxBlock;this.oldKey=l(this.opt.kwObj.value);this.hashValue="#sbox"+(this.factoryId||"");if(this.opt.placeholder){if(this.opt.placeholder=="搜索商品/店铺"&&this.opt.stype==2){this.opt.placeholder="搜索拼购商品"}this.opt.kwObj.setAttribute("placeholder",this.opt.placeholder)}!this.opt.noOutter&&(this.outter=this.smartQuery(".mod_searchbar"));if(this.outter&&s(this.outter.className,"fixed")){this.defalutFixed=true}if(window.GLOBAL_WXSQ_HEADERCONFIG.SMARTBOXCT){this.opt.css=this.opt.css.replace("{#timestr#}",window.GLOBAL_WXSQ_HEADERCONFIG.SMARTBOXCT)}else{this.opt.css=this.opt.css.replace("{#timestr#}","8c3faa17")}this.opt.css&&n(JD.url.getStaticDisRec(this.opt.css));if(I()){this.opt.searchUrl=this.opt.searchUrl.replace(/\/\/wqs\.jd\.com\/search\/index\.shtml/g,"//wqsou.jd.com/search/searchn")}if(location.hash==this.hashValue&&history.length>1){history.go(-1)}if(document.activeElement==this.opt.kwObj){location.hash=this.hashValue;this.isFucus=true;this.defalutFixed&&a(this.outter,"fixed")}if(this.opt.stype==2){this.opt.version="pingou"}else{if(f){this.opt.version="qq"}else{this.opt.version="weixin"}}if(this.opt.terminal){this.cgi=this.cgi.replace("{#version#}",this.opt.terminal)}else{this.cgi=this.cgi.replace("{#version#}",this.opt.version)}var r=JD.cookie.get("open_id"),o=JD.cookie.get("sq_open_id");this.ddHistory=r||o;this.showpps=JD.url.getUrlParam("_showpps")||""};y.initTpl=function(){this.opt.smartboxBlock.innerHTML=this.child_indextpl();this.opt.sTab=this.smartQuery('div[dtab="s-tab"]',this.opt.smartboxBlock);this.opt.sRow=this.smartQuery('ul[dtab="s-row"]',this.opt.smartboxBlock);this.opt.sBtn=this.smartQuery('div[dtab="s-btn"]',this.opt.smartboxBlock);this.opt.sTag=this.smartQuery('ul[dtab="s-tag"]',this.opt.smartboxBlock);this.opt.cBtn=this.smartQuery('div[dtab="c-btn"]',this.opt.smartboxBlock);this.opt.smartWrap=this.smartQuery('[dtab="smartWrap"]',this.opt.smartboxBlock);var e=(new Date).getTime(),t=Date.parse("2019/06/21 00:00:00");if(e<t){this._fwload=1}};y.bindEvent=function(){var t=this;t.addEvent(window,"hashchange",function(){t.hashChange()});t.addEvent(this.opt.kwObj,"focus",function(){if(t.isFucus&&location.hash==t.hashValue)return;t.isFucus=true;if(location.hash==t.hashValue){t.hashChange()}else{location.hash=t.hashValue;if(!t.sCssloaded){t.sCssloaded=true;if(!~location.href.indexOf("/search/searchn")&&window.GLOBAL_WXSQ_HEADERCONFIG.SEARCHCSS){window.setTimeout(function(){var e="_CSSPRELOAD"+Math.random();window[e]=new Image;window[e].src=JD.url.getStaticDisRec(window.GLOBAL_WXSQ_HEADERCONFIG.SEARCHCSS)},2e3)}}}});t.addEvent(t.opt.kwObj,"blur",function(){if(!t.isFucus)return;t.isFucus=false});t.addEvent(this.opt.kwObj,"touchstart",function(e){var r=t.opt.smartboxBlock.style.display!="none"&&(t.opt.sTab.style.display!="none"||t.opt.smartWrap.style.display!="none");t.reportJdMul(t.opt.rdprex+".1."+(r?"3":"2"),{px:e.pageX,py:e.pageY})});var r=t.opt.kwObj.parentNode;while(r&&r!==document.body&&r.tagName.toUpperCase()!=="FORM"){r=r.parentNode}if(r&&r.tagName.toUpperCase()==="FORM"){t.addEvent(r,"submit",function(e){e.preventDefault();t.opt.kwObj.blur();var r=l(t.opt.kwObj.value);if(r==""){if(t.drakInfo.onact&&t.drakInfo.link){if(window.JD){var o=decodeURIComponent(JD.url.getUrlParam("key",t.drakInfo.link)||"");o&&t.savekwLocalStorge(o)}t.jumpToTarget(t.drakInfo.link)}return}var a=t.genSearchUrl(r,"","",t.opt.searchRd,t.remKeyInfo.isRem?18:11,1);if(a){t.jumpToTarget(a)}if(t.remKeyInfo.isRem){t.reportJdMul(t.opt.rdprex+".1.6",{enkwd:t.remKeyInfo.okey,rekwd:t.remKeyInfo.rkey})}else{t.reportJdMul(t.opt.rdprex+".1.6",{sskey:r})}})}if(t.opt.searchBtn){t.addEvent(t.opt.searchBtn,f?"click":"touchstart",function(e){var r=l(t.opt.kwObj.value);if(r==""){if(t.drakInfo.onact&&t.drakInfo.link){if(window.JD){var o=decodeURIComponent(JD.url.getUrlParam("key",t.drakInfo.link)||"");var a=JD.url.getUrlParam("coupon_batch",t.drakInfo.link),s=JD.url.getUrlParam("activity_id",t.drakInfo.link);if(s||a){}else{o&&t.savekwLocalStorge(o)}}t.jumpToTarget(t.drakInfo.link)}return}var i=t.genSearchUrl(r,"","",t.opt.searchRd,t.remKeyInfo.isRem?18:11,1);if(i){t.jumpToTarget(i)}if(t.remKeyInfo.isRem){t.reportJdMul(t.opt.rdprex+".1.5",{px:e.pageX,py:e.pageY,enkwd:t.remKeyInfo.okey,rekwd:t.remKeyInfo.rkey})}else{t.reportJdMul(t.opt.rdprex+".1.5",{px:e.pageX,py:e.pageY,sskey:r})}})}if(t.opt.clearBtn){t.addEvent(t.opt.clearBtn,"touchstart",function(e){t.oldKey="";t.opt.kwObj.value="";t.opt.kwObj.focus();t.opt.keyInput&&t.opt.keyInput("");t.reportJdMul(t.opt.rdprex+".1.4",{px:e.pageX,py:e.pageY});e.preventDefault();if(t.opt.empMode===1){t.showHisAndHot()}else{t.hideWrap()}},true)}if(t.opt.cancelBtn){t.addEvent(t.opt.cancelBtn,"click",function(e){history.go(-1)})}e(t.opt.smartWrap,"click",function(e){var r=e.target,a=r.getAttribute("data-type");while(r!==this&&r.tagName.toLocaleLowerCase()!="li"&&!a){r=r.parentNode;a=r.getAttribute("data-type")}var s=r.getAttribute("key"),i=r.getAttribute("cid"),n=r.getAttribute("level"),p="";if(/(\s+|^)stick_top(\s+|$)/.test(e.target.className)){t.opt.kwObj.value=s;t.isFucus?t.hashChange():t.opt.kwObj.focus();return}if(a=="shop"){p=t.genShopSearchUrl(s,t.opt.searchRd,0)}else if(a=="global"){p=t.genSearchUrl(s,i,n,t.opt.searchRd,17,0,1)}else if(a=="act"){var d=r.getAttribute("ico"),c=r.getAttribute("dec");p=t.genSearchUrl(s,i,n,t.opt.searchRd,19,0,2,d,c)}else if(a=="prom"){p=r.getAttribute("data-url");p=v(p,"sourcefrom","xiala");p=v(p,"key",encodeURIComponent(l(t.opt.kwObj.value)));if(t.version){p=v(p,"version",t.version)}p=v(p,"sf","61")}else if(a=="prom2"){var h=r.getAttribute("filtype");if(h=="&art=1"){p=t.genSearchUrl(l(t.opt.kwObj.value),i,n,t.opt.searchRd,62,0,3)}}else{p=t.genSearchUrl(s,i,n,t.opt.searchRd,a=="jump-tag"?13:12,0)}if(p){t.oldKey="";o(r,"active");t.jumpToTarget(p)}e.preventDefault()});t.setSuggestTimer();t.bindHisEvent();window.JD&&JD.events.listen("pageshow",function(){if(location.hash==t.hashValue){history.go(-1)}})};y.hashChange=function(){var e=this;var t=window.location.hash;if(t==e.hashValue){e.loadSuggest();var r=l(e.opt.kwObj.value);if(r==""){e.opt.empMode===1&&e.showHisAndHot()}else{e.hideHisAndHot();e.opt.clearBtn&&e.smartShow(e.opt.clearBtn,"")}e.smartShow(e.opt.smartboxBlock,"");if(e.drakInfo.onact){e.opt.kwObj.setAttribute("placeholder",e.drakInfo.desc)}this.defalutFixed&&a(this.outter,"fixed");e.opt.showCb&&e.opt.showCb();window.wa&&window.wa("ptagExposure",{ptag:"37024.26.1"})}else{e.oldKey="";e.opt.kwObj.blur();e.hideWrap();e.onShow&&e.reportJdMul(e.opt.rdprex+".1.1");if(e.drakInfo.onact){e.opt.kwObj.setAttribute("placeholder",e.drakInfo.text)}this.defalutFixed&&o(this.outter,"fixed");e.opt.hideCb&&e.opt.hideCb()}};y.bindHisEvent=function(){var e=this;e.addEvent(e.opt.sRow,f?"click":"touchstart",function(t){var r=t.target;while(r!==this&&r.tagName.toLocaleLowerCase()!="li"){r=r.parentNode}var o=r.getAttribute("key"),a=r.getAttribute("pt"),s=r.getAttribute("dec"),i=r.getAttribute("mark"),n=r.getAttribute("pid");if(o){var p="";if(a==1){p=e.genShopSearchUrl(o,e.opt.searchRd,0)}else if(a==2){p=e.genSearchUrl(o,"","",e.opt.searchRd,14,0,1)}else if(a==3){p=e.genSearchUrl(o,"","",e.opt.searchRd,14,0,2,i,s)}else{p=o.indexOf(e.opt.shopKwFix)!=-1?e.genShopSearchUrl(o.replace(e.opt.shopKwFix,""),e.opt.searchRd,0):o.indexOf(e.opt.gloabalKwFix)!=-1?e.genSearchUrl(o.replace(e.opt.gloabalKwFix,""),"","",e.opt.searchRd,14,0,1):e.genSearchUrl(o,"","",e.opt.searchRd,14,0)}if(p){if(n){p+="&projectId="+n}e.jumpToTarget(p)}}});e.addEvent(e.opt.sBtn,"click",function(){e.saveStorage("search_kw_history",[],true);e.smartShow(e.opt.sBtn.parentNode,"none");e.smartShow(e.opt.sRow.parentNode,"none");if(e.ddHistory){JD.sendJs("//wq.jd.com/bases/searchxg/gethissearch?callback=ddhistorydelCb&delall=1");e.ddHiscache=[]}});window.ddhistorydelCb=function(){};e.addEvent(e.opt.sTag,f?"click":"touchstart",function(t){var r=t.target;while(r!==this&&r.tagName.toLocaleLowerCase()!="li"){r=r.parentNode}var o=r.getAttribute("key"),a=r.getAttribute("tarHref");if(o){e.savekwLocalStorge(o)}if(a){e.jumpToTarget(a)}});e.addEvent(e.opt.cBtn,"click",function(){e.hotPageInfo.page+=1;if(e.hotPageInfo.page>e.hotPageInfo.totPage){e.hotPageInfo.page=1}e.loadHotListV2()})};y.setSuggestTimer=function(){var e=this;if(e.isFucus){var t=l(e.opt.kwObj.value);if(t!=e.oldKey){e.oldKey=t;e.loadSuggest();e.opt.keyInput&&e.opt.keyInput(t)}if(t!=""){e.smartShow(e.opt.clearBtn,"");if(e.onShow){e.onShow&&e.opt.empMode===1&&e.hideHisAndHot()}}else{e.smartShow(e.opt.clearBtn,"none");if(!e.onShow){if(e.opt.empMode===1){e.showHisAndHot()}else{e.hideWrap()}}if(e.drakInfo.onact){e.opt.kwObj.setAttribute("placeholder",e.drakInfo.desc)}}}e.addEvent(e.opt.kwObj,"input",r);e.addEvent(e.opt.kwObj,"propertychange",r);function r(){e.dtimer&&window.clearTimeout(e.dtimer);e.dtimer=window.setTimeout(function(){var t=l(e.opt.kwObj.value);if(t!=e.oldKey){e.oldKey=t;e.loadSuggest();e.opt.keyInput&&e.opt.keyInput(t)}if(t!=""){e.smartShow(e.opt.clearBtn,"");if(e.onShow){e.onShow&&e.opt.empMode===1&&e.hideHisAndHot()}}else{e.smartShow(e.opt.clearBtn,"none");if(!e.onShow){if(e.opt.empMode===1){e.showHisAndHot()}else{e.hideWrap()}}if(e.drakInfo.onact){e.opt.kwObj.setAttribute("placeholder",e.drakInfo.desc)}}e.remKeyInfo.isRem=false},e.opt.deley)}};y.loadSuggest=function(){var e=this;var t=l(e.opt.kwObj.value);if(!t||!e.isFucus){return}var r=e.cgi.replace(/{#key#}/,encodeURIComponent(t));e.cgiMonitor.smartboxTimer=window.setTimeout(function(){try{JD.report.umpBiz({bizid:"36",operation:"2",result:"0",source:"0",message:"smartbox api timeout"});e.opt.stype==2&&JD.report.umpBiz({bizid:"36",operation:"21",result:"0",source:"0",message:"pg_smartbox api timeout"})}catch(e){}},e.cgiMonitor.timeout);JD.sendJs(r)};window.ddSearchCb=function(e){var t=k[this.factoryId||0];t.cgiMonitor.smartboxTimer&&window.clearTimeout(t.cgiMonitor.smartboxTimer);var r={bizid:"36",operation:"1",result:"0",source:"0",message:"smartbox api loaded"};var o={bizid:"36",operation:"20",result:"0",source:"0",message:"pg_smartbox api loaded"};if(!e||e.length==0){r={bizid:"36",operation:"3",result:"0",source:"0",message:"smartbox api empty"};o={bizid:"36",operation:"22",result:"0",source:"0",message:"pg_smartbox api empty"}}try{JD.report.umpBiz(r);t.opt.stype==2&&JD.report.umpBiz(o)}catch(e){}var a=l(t.opt.kwObj.value);if(!a)return;var s=[],i=[],n=0,p=[],d=[],c=new RegExp("("+a.replace(/([\+\*\.\?\|\^\(\)\{\}\[\]\/\\])/g,"\\$1")+")","g");if(e&&e.length>0){for(var h=0,u=e.length;h<u;++h){var f=e[h];if(f.version){t.version=f.version}else if(f.wqif){p=f.wqif}else{d.push(f)}}p.sort(function(e,t){return e.sho-t.sho});for(var h=0,u=p.length;h<u&&n<2;++h){var w=p[h];if(w.iftp==0){s.push(t.child_shoptpl({keyword:w.shq,rd:t.opt.rdprex+".14.1"}))}if(w.iftp==1){w.rd=t.opt.rdprex+".14.5";s.push(t.child_globaltpl(w))}if(w.iftp==2){w.rd=t.opt.rdprex+".14.8";s.push(t.child_acqtpl(w))}if(w.iftp==3&&w.prt&&w.pru&&(w.prt.indexOf("&")>-1?w.prp:true)){w.rd=t.opt.rdprex+".14.10";s.push(t.child_promtpl(w))}if(w.iftp==4){w.rd=t.opt.rdprex+".14.11";s.push(t.child_prom2tpl(w))}n++}for(var h=0,u=d.length;h<u;++h){var m=d[h];if(m.rem){var g=m.rem.rei,y=m.rem.req,v=g&&g.length,b=y&&y.length;t.opt.kwObj.value=y;t.opt.kwObj.selectionStart=v;t.opt.kwObj.selectionEnd=b;t.remKeyInfo.isRem=true;t.remKeyInfo.okey=g;t.remKeyInfo.rkey=y}if(!m.key)continue;m.pos=h;if(m.bra){m.rd=t.opt.rdprex+".14.6";i.push(t.child_sel2tpl(m))}else{if(m.ci){}else if(m.rem){}else{m.rd=t.opt.rdprex+".14.3";m.keywordStr=m.key&&m.key.replace(c,'<span class="search_string">$1</span>');s.push(t.child_seltpl(m))}}}}if(i.length>s.length){t.opt.smartWrap.className="hot_sale_service";t.opt.smartWrap.innerHTML=i.join("");t.smartShow(t.opt.smartboxBlock,"");t.smartShow(t.opt.smartWrap,"")}else if(s.length>0){t.opt.smartWrap.className="s_row";t.opt.smartWrap.innerHTML=s.join("");t.smartShow(t.opt.smartboxBlock,"");t.smartShow(t.opt.smartWrap,"")}};y.genSearchUrl=function(e,t,r,o,a,s,i,n,p){if(!e)return"";e=e.replace(/\s+/g," ");var l=this;var d="";if(e.indexOf("item.jd.com")>0||e.indexOf("item.m.jd.com")>0){var c=e.match(/[\d]+/);if(c&&c.length){e=c[0]}}if(typeof l.opt.searchUrl=="function"){l.opt.searchUrl(e,t,r,o)}else{d=l.opt.searchUrl.replace(/{#key#}/g,encodeURIComponent(e)).replace(/{#sf#}/g,a).replace(/{#as#}/g,s);if(t&&r){var h=r==1?"cid1":r==2?"cid2":"catid";d=v(d,"filt_type",h+",L"+t+"M"+t+";")}if(o){d+="&PTAG="+o}if(i==1){d=v(d,"filt_type","product_ext,b11v1;")}else if(i==2){d=v(d,"filt_type","ico,L"+n+"M"+n+";")}else if(i==3){d=v(d,"filt_type","productext2,b5v1;")}if(l.version){d=v(d,"version",l.version)}}if(l.showpps){d=v(d,"_showpps",l.showpps)}if(i==1){l.opt.kwObj.value=e;l.savekwLocalStorge(e,2)}else if(i==2){l.savekwLocalStorge(e,3,n,p)}else{l.opt.kwObj.value=e;l.savekwLocalStorge(e)}return d};y.genShopSearchUrl=function(e,t,r){e=e.replace(/\s+/g," ");var o=this,a="";if(typeof o.opt.shopSearchUrl=="function"){o.opt.shopSearchUrl(e,t,r)}else{a=o.opt.shopSearchUrl.replace(/{#key#}/g,encodeURIComponent(e)).replace(/{#sf#}/g,16).replace(/{#as#}/g,r);if(t){a+="&PTAG="+t}}if(o.version){a=v(a,"version",o.version)}if(o.showpps){a=v(a,"_showpps",o.showpps)}o.opt.kwObj.value=e;o.savekwLocalStorge(e,1);return a};y.showHisAndHot=function(){var e=this;if(e.onShow)return;e.onShow=true;e.smartShow(e.opt.sRow,"");e.smartShow(e.opt.sBtn,"");e.smartShow(e.opt.sTag,"");e.displayHotChange();e.smartShow(e.opt.sTab,"");e.smartShow(e.opt.smartWrap,"none");if(e.ddHistory&&A()){e.initHistoryV2()}else{e.initHistory()}e.loadHotList();if(e._fwload==1){e.loadActFenwei();e._fwload=2}};y.hideHisAndHot=function(){var e=this;if(!e.onShow)return;e.onShow=false;e.smartShow(e.opt.sRow,"none");e.smartShow(e.opt.sBtn,"none");e.smartShow(e.opt.sTag,"none");e.smartShow(e.opt.cBtn,"none");e.smartShow(e.opt.sTab,"none")};y.initHistory=function(){var e=this;var t=e.getStorage("search_kw_history");if(t&&t!=="[]"){t=JSON.parse(t)}else{t=[]}e.smartShow(e.opt.sTab,"");if(!t||t.length<=0){e.smartShow(e.opt.sBtn.parentNode,"none");e.smartShow(e.opt.sRow.parentNode,"none")}else{e.smartShow(e.opt.sBtn.parentNode,"");e.smartShow(e.opt.sRow.parentNode,"");var r=[],o=t.length;for(var a=o-1;a>=0;--a){var s=t[a];if(typeof s=="string"){s={key:d(s),rd:e.opt.rdprex+".8."+(o-a+2)};s.keystr=s.key}else{s.key=d(s.key);s.rd=e.opt.rdprex+".8."+(o-a+2);if(s.type==1){s.keystr=s.key+e.opt.shopKwFix}else if(s.type==2){s.keystr=s.key+e.opt.gloabalKwFix}else if(s.type==3){s.keystr=s.key+"（"+d(s.dec)+"）"}else{s.keystr=s.key}}r.push(e.child_historytpl(s))}e.opt.sRow.innerHTML=r.join("")}return t&&t.length>0};y.initHistoryV2=function(){var e=this;if(e.ddHiscache!=null){e.showHistorys();return}var t="//wq.jd.com/bases/searchxg/gethissearch?callback=hissearchCb";window.hissearchCb=function(t){if(t.retcode==0){e.ddHiscache=t.hiskeylist;e.showHistorys(true)}};JD.sendJs(t)};y.showHistorys=function(e){var t=this,r=t.ddHiscache,o=r.length;if(o<=0){t.smartShow(t.opt.sBtn.parentNode,"none");t.smartShow(t.opt.sRow.parentNode,"none")}else{t.smartShow(t.opt.sBtn.parentNode,"");t.smartShow(t.opt.sRow.parentNode,"");var a=[],s=new RegExp(t.opt.shopKwFix,"g");for(var i=0;i<o;++i){var n=r[i];e&&(n.key=d(n.key));n.rd=t.opt.rdprex+".8."+(i+3);if(s.test(n.key)){n.key=n.key.replace(s,"");n.keystr=n.key+t.opt.shopKwFix;n.type=1}else{n.keystr=n.key}a.push(t.child_historyV2tpl(n))}t.opt.sRow.innerHTML=a.join("")}};y.loadHotList=function(){var e=this;if(e.hotwords!=null){return}e.loadHotListV2(1)};y.loadHotListV2=function(e){var t=this;e&&(t.hotPageInfo.page=e);var r=f?t.opt.qqruleid||t.hotPageInfo.qqruleid:t.opt.wxruleid||t.hotPageInfo.wxruleid;if(t.opt.stype==2){r="1108"}var o=t.opt.hotUrl.replace("{#ruleid#}",r).replace("{#page#}",t.hotPageInfo.page).replace("{#pagesize#}",t.opt.pagesize||t.hotPageInfo.pagesize).replace("{#tpl#}",t.opt.tpl||1);if(JD.disasterRecovery&&JD.disasterRecovery.keywordsearch&&JD.disasterRecovery.keywordsearch.useStaticUrl){o=f?"//wqs.jd.com/data/coss/recovery/keyword2/3/c658c69b347b89e4cd8b734c42da17d9.shtml":"//wqs.jd.com/data/coss/recovery/keyword2/4/bf166f0c47d3a2683b452ca28ce3ef8d.shtml"}window.hotwordCb=function(e){if(e.errCode!=0)return;t.projectId=e.projectid;t.hotwords=e.data.list;t.hotPageInfo.totPage=Math.ceil(e.total/t.opt.pagesize);t.displayHotChange();t.showHotListV2()};try{JD.report.umpBiz({bizid:"36",operation:"4",result:"0",source:"0",message:"smartbox loadHot loaded"})}catch(e){}JD.sendJs(o)};y.showHotListV2=function(){var e=this;var t=[];for(var r=0,o=e.hotwords.length;r<o;++r){var a=e.hotwords[r];a.key=a.keyword;a.url=a.link;a.rd=e.opt.rdprex+".33."+(r+3);a.url=v(a.url,"sf",15);e.opt.hotRd&&(a.url=v(a.url,"ptag",e.opt.hotRd,"",true));a.url=e.modSearchUrl(a.url);t.push(e.child_hottpl(a))}e.opt.sTag.innerHTML=t.join("")};y.displayHotChange=function(){if(this.hotPageInfo.totPage<=1){this.smartShow(this.opt.cBtn,"none")}else{this.smartShow(this.opt.cBtn,"")}};y.showWrap=function(){this.smartShow(this.opt.smartboxBlock,"");this.smartShow(this.opt.smartWrap,"");this.defalutFixed&&a(this.outter,"fixed");this.opt.showCb&&this.opt.showCb()};y.hideWrap=function(){this.smartShow(this.opt.smartboxBlock,"none");this.smartShow(this.opt.smartWrap,"none");this.opt.keyInput&&this.opt.keyInput("")};y.savekwLocalStorge=function(e,t,r,o){var a=this;var s=a.getStorage("search_kw_history");if(s&&s!=="[]"){s=JSON.parse(s)}else{s=[]}var i=-1;for(var n=0,p=s.length;n<p;++n){var l=s[n];if(typeof l=="string"){if(t==1){if(l.indexOf(a.opt.shopKwFix)!=-1&&l.replace(a.opt.shopKwFix,"")==e){i=n;break}}else if(!t&&e==l){i=n;break}}else if(e==l.key){if(t){if(t==l.type){if(t<3){i=n;break}else if(r==l.mark){i=n;break}}}else{i=n;break}}}if(i>-1){s.splice(i,1)}if(s.length>=10){s.shift()}var d={key:e,type:t?t:"",mark:r?r:"",dec:o?o:""};s.push(d);a.saveStorage("search_kw_history",s,true)};y.initDark=function(){if(this.opt.noDark)return;var e=this,t=f?this.opt.qqAdid:this.opt.wxAdid,r="";if(j()){t=181}r="//wqcoss.jd.com/mcoss/hiddenword/HiddenwordSearch?callback=HiddenwordSearch&projectid="+t+"&total=18";window["HiddenwordSearch"]=function(e){if(e.errCode==0){try{JD.report.umpBiz({bizid:"36",operation:"5",result:"0",source:"0",message:"smartbox loaded dark success"})}catch(e){}if(e.errCode!=0)return;var t=e.projectid,r=e.data,a=r.length,s=0;if(a>0){o(r[s]);window.wa&&window.wa("ptagExposure",{ptag:(f?"7230.2.":"7230.1.")+t});window.setInterval(function(){s++;if(s>=a)s=0;o(r[s])},1e4)}}};JD.sendJs(r);function o(t){e.drakInfo.onact=true;e.drakInfo.text=(e.opt.darkPre?e.opt.darkPre+" ":"")+t.plancontent;e.drakInfo.desc=(e.opt.darkPre?e.opt.darkPre+" ":"")+t.searchname;e.drakInfo.key=t.searchname;var r=t.hiddenwordid,o=v(t.url,"hiddenid",r);o=v(o,"sf",20);o=v(o,"ptag",e.opt.darkRd||"38013.1.1");e.drakInfo.link=e.modSearchUrl(o);if(e.isFucus){e.opt.kwObj.setAttribute("placeholder",e.drakInfo.desc)}else{e.opt.kwObj.setAttribute("placeholder",e.drakInfo.text)}}};y.modSearchUrl=function(e){e=e.replace(/\/\/wq\.jd\.com\/search\/searchn?\?/,"//wqsou.jd.com/search/searchn?");if(this.showpps){e=v(e,"_showpps",this.showpps)}return e};y.saveStorage=function(e,t,r){try{window.localStorage.setItem(e,r?JSON.stringify(t):t)}catch(e){}};y.getStorage=function(e){return window.localStorage.getItem(e)};y.smartQuery=function(e,t){return t?t.querySelector(e):document.querySelector(e)};y.smartQueryAll=function(e,t){return t?t.querySelectorAll(e):document.querySelectorAll(e)};y.smartShow=function(e,t){if(e){e.style.display=t}};y.addEvent=function(t,r,o,a){if(typeof $!=="undefined"&&$){if(r==="touchstart"){$(t).on("tap",o)}else{$(t).on(r,o)}}else{if(r==="touchstart"&&!a){e(t,"click",o)}else{e(t,r,o)}}};y.loadActFenwei=function(){var e=this;try{e.opt.sTab.style.background='url("//img11.360buyimg.com/jdphoto/s750x1225_jfs/t1/40351/28/7729/97568/5cee858aE8e5ab6c6/1c5ba523b685c564.png") no-repeat';e.opt.sTab.style.backgroundSize="100% 100%";e.opt.sTab.style.minHeight=(window.screen.availHeight||window.screen.height)-(h?150:f?90:50)+"px"}catch(e){}};function v(e,t,r,o,a){var s=new RegExp("([?&]"+t+"=)([^&#]*)","gi");if(s.test(e)){if(a){e=e.replace(s,"$1"+r)}else{e=e.replace(s,"$1$2"+(o?o:"")+r)}}else{var i=~e.indexOf("?")?"&":"?",n=e.indexOf("#");if(n>-1){var p=e.split("#"),l=p[0],d=p[1];e=l+i+t+"="+r+"#"+d}else{e+=i+t+"="+r}}return e}y.jumpToTarget=function(e){if(c)return;c=true;var t=this;var r=JD&&JD.url?JD.url.getUrlParam("forcewqs"):"";var o=JD&&JD.url?JD.url.getUrlParam("sceneval"):"";if((!I()||r==1)&&/\/\/wq(sou)?\.jd\.com\/search\/searchn?\?/.test(e)){e=e.replace(/\/\/wq(sou)?\.jd\.com\/search\/searchn?\?/g,"//wqs.jd.com/search/index.shtml?");if(r==1){e=v(e,"forcewqs","1")}}if(o){e=v(e,"sceneval",o)}else if(!h&&!u&&!f){e=v(e,"sceneval","2")}else{e=e.replace(/sceneval=2(?!\d)&?/g,"");if(f&&w=="1"){e=v(e,"ss_close","1")}}e=x(e);e=_(e,t.opt.songli);e=S(e,t.opt.stype);if(JD&&JD.wxapp&&r!=1){var a=b.call(t,e,1e3);JD.wxapp.isWxapp(function(r){a&&window.clearTimeout(a);var o=JD.wxapp.transform.search(e);if(JD.wxapp.wxappType==2){var s=e.match(/[?&]key=([^&#]*)/i);if(s.length>1){o="/pages/pingou_second/search/search?key="+s[1]}}else if(t.opt.stype==2){o=""}if(r&&o){JD.wxapp.goto(o);c=false}else{b.call(t,e)}})}else{b.call(t,e)}};function b(e,t){var r=this;return window.setTimeout(function(){c=false;if(f&&window.mqq&&mqq.ui&&mqq.ui.openUrl){mqq.ui.openUrl({url:e})}else if(h){location.href=e}else{location.hash==r.hashValue?location.replace(e):location.href=e}},t||200)}y.factory=function(){m++;t(this,y,g(m));k.push(this);window["ddSearchCb"+m]=window.ddSearchCb.bind(this);return this};function x(e){if(location.href.indexOf("wqs.jd.com/portal/sq/chaoshi/index.shtml")>0||location.href.indexOf("wq.jd.com/mcoss/mportal/show?tabid=12&tpl=12")>0){e=v(e,"jd_market_sort","yes")}return e}function _(e,t){t=parseInt(t)||(window._unsearch&&window._unsearch.ptype=="songli"?1:0)||JD.url.getUrlParam("songli");return t==1?v(e,"songli",1):e}function S(e,t){if(t==2){e=v(e,"filt_type","productext2,b12v1;");e=v(e,"frompg","1")}return e}function j(){var e=(JD.cookie.get("wq_addr")||"").split("|"),t=false;if(e.length>1){var r=e[1].split("_");if(r&&r.length>0&&~" 32 84 52993 53283 ".indexOf(" "+r[0]+" ")){t=true}}return t}function I(){var e=50,t=JD.cookie.get("visitkey"),r=(t||"0").substr(-2),o=parseInt(r,10);if(typeof window.smartboxGrayStrategy!="undefined"){e=window.smartboxGrayStrategy}return e==99||e&&e>=o}function A(){var e=parseInt(window.GLOBAL_WXSQ_HEADERCONFIG.SMARTBOX_HISGRAY||99,10),t=JD.cookie.get("visitkey"),r=(t||"0").substr(-2),o=parseInt(r,10);return e==99||e&&e>=o}y.reportJdClick=function(){var e=this;this.addEvent(this.opt.smartboxBlock,"touchstart",function(t){var r=t.target,o=r.getAttribute("rd");while(!o&&r!==e.opt.smartboxBlock){r=r.parentNode;o=r.getAttribute("rd")}if(!o)return;var a=r.getAttribute("data-type"),s=r.getAttribute("pid"),i=r.getAttribute("rekwd")||"",n=r.getAttribute("enpos")||"",p=r.getAttribute("tag")||"",l=r.getAttribute("tagpos")||"";try{var d={rekwd:encodeURIComponent(i),enpos:n,tag:encodeURIComponent(p),tagpos:l};var c={ptag:o,px:t.pageX,py:t.pageY,enkwd:encodeURIComponent(y.oldKey),version:e.version};for(var h in d){if(d[h]){c[h]=d[h]}}s&&(c.projectId=s);if(a=="jump-tag"){c.ss_key=encodeURIComponent(r.getAttribute("key")||"")}window.wa&&window.wa("jdClick",c)}catch(t){}})};y.reportJdMul=function(e,t){var r=this;try{var o={ptag:e,px:t.px||0,py:t.py||0,version:r.version};if(t.enkwd&&t.rekwd){o.enkwd=encodeURIComponent(t.enkwd);o.rekwd=encodeURIComponent(t.rekwd)}if(t.sskey){o.ss_key=encodeURIComponent(t.sskey)}window.wa&&window.wa("jdClick",o)}catch(e){}};y.child_cstpl=function(e){return'<li data-type="jump" key="'+e.key+'" level="'+e.cle+'" cid="'+e.cid+'" rd="'+e.rd+'"><span><span class="search_string">'+e.key+'</span><small class="search_where">在'+e.cna+"分类下搜索</small></span></li>"};y.child_seltpl=function(e){var t='<li data-type="jump" key="'+e.key+'" rd="'+e.rd+'" enpos="'+(e.pos+1)+'" rekwd="'+e.key+'"><div class="result_key">'+e.keywordStr+"</div>";t+='<i class="stick_top" rd="7092.14.11"></i>';if(e.tag){t+='<div class="word_list">';for(var r=0,o=e.tag.length;r<o;++r){var a=e.tag[r];t+='<span class="word" data-type="jump-tag" key="'+a.tse+'" rd="'+this.opt.rdprex+'.14.7" rekwd="'+e.key+'" tag="'+a.tsh+'" enpos="'+(e.pos+1)+'"  tagpos="'+(r+1)+'">'+a.tsh+"</span>"}t+="</div>"}return t+"</li>"};y.child_sel2tpl=function(e){return'<a href="javascript:" class="item" data-type="jump" key="'+e.key+'" rd="'+e.rd+'"><div class="main"><p class="name">'+e.key+'</p><p class="price">&yen;'+e.pri+'</p></div><div class="detail"><p class="brand">'+e.bra+'</p><p class="config">'+e.des+"</p></div></a>"};y.child_shoptpl=function(e){return'<li data-type="shop" rd="'+e.rd+'" key="'+e.keyword+'" rekwd="'+e.keyword+'"><i class="icon_shop"></i>搜索 “<span class="search_string">'+e.keyword+"</span>” 相关的店铺</li>"};y.child_globaltpl=function(e){return'<li data-type="global" key="'+e.shq+'" rd="'+e.rd+'" rekwd="'+e.shq+'"><i class="icon_global"></i>在 海囤全球 下搜索 <span class="search_string">'+e.shq+"</span></li>"};y.child_historytpl=function(e){return'<li class="keyword" pt="'+(e.type?e.type:"")+'" mark="'+(e.mark?e.mark:"")+'" dec="'+(e.dec?e.dec:"")+'" key="'+e.key+'" rd="'+e.rd+'" pid="-10"><a href="javascript:" rd="'+e.rd+'" pid="-10">'+e.keystr+"</a></li>"};y.child_historyV2tpl=function(e){return'<li class="keyword" pt="'+(e.type?e.type:"")+'" key="'+e.key+'" rd="'+e.rd+'" pid="-10"><a href="javascript:" rd="'+e.rd+'" pid="-10">'+e.keystr+"</a></li>"};y.child_hottpl=function(e){return'<li class="keyword'+(e.isDark?" hilight":"")+'" tarHref="'+(e.url||e.link)+'" key="'+e.key+'" rd="'+e.rd+'" pid="'+this.projectId+'"><a href="javascript:" rd="'+e.rd+'" pid="'+this.projectId+'">'+(e.isDark?e.key:e.keyword)+"</a></li>"};y.child_indextpl=function(){return'<div class="search_panel_wrapper" dtab="s-tab" style="display:none;"><div class="search_panel_title"><div class="text">最近搜索</div><div class="title_btn" dtab="s-btn" rd="'+this.opt.rdprex+'.33.1">清除</div></div><div class="search_panel_con two_row"><ul class="tags" dtab="s-row"></ul></div><div class="search_panel_title"><div class="text">热门搜索</div><div class="title_btn" style="display: none;" dtab="c-btn" rd="'+this.opt.rdprex+'.33.2">换一批</div></div><div class="search_panel_con"><ul class="tags" dtab="s-tag"></ul></div></div><ul class="s_row" dtab="smartWrap" style="display:none;"> </ul>'};y.child_acqtpl=function(e){var t=e.acu.replace(/^\&icon=/,"");return'<li data-type="act" dec="'+e.acq+'" key="'+e.shq+'" ico="'+t+'" rd="'+e.rd+'"><i class="icon_link"></i>在 <span class="txt_tag"><img src="//img12.360buyimg.com/cms/'+e.acp+'"></span>下搜索 <span class="search_string">'+e.shq+"</span></li>"};y.child_promtpl=function(e){var t=e.prt.replace("&",' <span class="txt_tag"><img src="'+e.prp+'"></span>');return'<li data-type="prom" data-url="'+e.pru+'" rd="'+e.rd+'"><i class="icon_link"></i><span>'+t+"</span></li>"};y.child_prom2tpl=function(e){return'<li data-type="prom2" filtype="'+e.ftt+'" rd="'+e.rd+'"><span class="txt_tag"><img src="'+e.icu+'"></span>在 '+e.act+' 下搜索 <span class="search_string">'+e.shq+"</span></li>"};return y});